<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spaced Repetition Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --primary: #4a90e2;
      --secondary: #87ceeb;
      --accent: #b3d9ff;
      --warning: #f5d5a8;
      --danger: #e5a8a8;
      --bg: linear-gradient(135deg, #ffffff 0%, #e6f3ff 50%, #cce7ff 100%);
      --card-bg: rgba(255, 255, 255, 0.9);
      --text: #2c3e50;
      --text-light: #718096;
      --border: rgba(74, 144, 226, 0.2);
      --shadow: 0 4px 20px rgba(74, 144, 226, 0.1);
      --shadow-hover: 0 8px 30px rgba(74, 144, 226, 0.15);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      color: var(--text);
      min-height: 100vh;
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--text);
      font-weight: 600;
      font-size: 2rem;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-bottom: 30px;
    }

    .controls button {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .controls button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .controls input[type="file"] {
      display: none;
    }

    .table-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    th {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    th:first-child {
      border-radius: 15px 0 0 0;
    }

    th:last-child {
      border-radius: 0 15px 0 0;
    }

    td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    input[type="text"],
    input[type="date"] {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid var(--border);
      border-radius: 15px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--text);
      transition: all 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="date"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(168, 181, 229, 0.2);
      transform: scale(1.02);
    }

    .color-picker-wrapper {
      position: relative;
      display: inline-block;
    }

    input[type="color"] {
      appearance: none;
      -webkit-appearance: none;
      border: 3px solid white;
      width: 40px;
      height: 40px;
      padding: 0;
      background: none;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 
        0 0 0 2px rgba(74, 144, 226, 0.2),
        0 4px 12px rgba(0, 0, 0, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
      border: none;
      border-radius: 50%;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 50%;
    }

    input[type="color"]::-moz-color-swatch {
      border: none;
      border-radius: 50%;
    }

    input[type="color"]:hover {
      transform: scale(1.1);
      box-shadow: 
        0 0 0 3px rgba(74, 144, 226, 0.3),
        0 6px 20px rgba(0, 0, 0, 0.15);
      border-color: rgba(255, 255, 255, 0.9);
    }

    input[type="color"]:active {
      transform: scale(0.95);
    }

    .color-picker-wrapper::after {
      content: 'ðŸŽ¨';
      position: absolute;
      top: -8px;
      right: -8px;
      background: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      pointer-events: none;
      transition: all 0.3s ease;
      opacity: 0.8;
    }

    .color-picker-wrapper:hover::after {
      transform: scale(1.1);
      opacity: 1;
    }

    /* Modern Toggle Switch */
    .toggle-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .toggle {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #cbd5e0;
      transition: all 0.4s ease;
      border-radius: 34px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background: white;
      transition: all 0.4s ease;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    input:checked + .slider {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    input:focus + .slider {
      box-shadow: 0 0 1px #2196F3, 0 0 0 3px rgba(33, 150, 243, 0.2);
    }

    .delete-btn {
      background: linear-gradient(135deg, var(--danger), #ff6b6b);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      font-weight: 500;
      box-shadow: 0 2px 10px rgba(229, 168, 168, 0.3);
    }

    .delete-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(229, 168, 168, 0.4);
    }

    #calendar {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
    }

    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, var(--accent), #4facfe);
      color: white;
      padding: 15px 25px;
      border-radius: 20px;
      box-shadow: var(--shadow-hover);
      display: none;
      z-index: 1000;
      font-weight: 500;
      backdrop-filter: blur(10px);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Custom Calendar Styling */
    .fc-theme-standard .fc-scrollgrid {
      border-radius: 15px;
      overflow: hidden;
    }

    .fc-theme-standard td, .fc-theme-standard th {
      border-color: var(--border);
    }

    .fc-daygrid-event {
      border-radius: 8px;
      border: none;
      font-size: 11px;
      font-weight: 500;
      padding: 2px 6px;
    }

    .fc-button-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary)) !important;
      border: none !important;
      border-radius: 12px !important;
      font-weight: 500 !important;
      padding: 8px 16px !important;
    }

    .fc-button-primary:hover {
      background: linear-gradient(135deg, var(--secondary), var(--primary)) !important;
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .container {
        padding: 10px;
      }
      
      table {
        font-size: 12px;
      }
      
      th, td {
        padding: 10px 5px;
      }
      
      .toggle {
        width: 50px;
        height: 28px;
      }
      
      .slider:before {
        height: 22px;
        width: 22px;
        left: 3px;
        bottom: 3px;
      }
      
      input:checked + .slider:before {
        transform: translateX(22px);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>âœ¨ Spaced Repetition Calendar</h2>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Topic</th>
            <th>Start Date</th>
            <th>Color</th>
            <th>Enable Review</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="topicBody"></tbody>
      </table>
    </div>

    <div class="controls">
      <button onclick="addRow()"><i class="fas fa-plus"></i> Add Topic</button>
      <button onclick="generateSchedule()"><i class="fas fa-calendar-check"></i> Generate Calendar</button>
      <button onclick="exportTopics()"><i class="fas fa-file-export"></i> Export Topics</button>
      <button onclick="document.getElementById('importFile').click()"><i class="fas fa-file-import"></i> Import Topics</button>
      <input type="file" id="importFile" accept=".json" onchange="importTopics(event)">
    </div>

    <div id="calendar"></div>
    <div id="toast" class="toast"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      loadSavedTopics();
      generateSchedule();
    });

    function addRow(topic = "", date = "", color = "#4a90e2", reviewEnabled = true) {
      const table = document.getElementById("topicBody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><input type="text" class="topicName" value="${topic}" placeholder="e.g. Graph Algorithms"></td>
        <td><input type="date" class="startDate" value="${date}"></td>
        <td>
          <div class="color-picker-wrapper">
            <input type="color" class="topicColor" value="${color}" title="Pick a color">
          </div>
        </td>
        <td>
          <div class="toggle-container">
            <label class="toggle">
              <input type="checkbox" class="enableReview" ${reviewEnabled ? "checked" : ""}>
              <span class="slider"></span>
            </label>
          </div>
        </td>
        <td><button class="delete-btn" onclick="removeRow(this)"><i class="fas fa-trash"></i></button></td>
      `;
      table.appendChild(row);
      row.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", saveTopicsToStorage);
      });
    }

    function removeRow(btn) {
      btn.closest("tr").remove();
      saveTopicsToStorage();
    }

    function saveTopicsToStorage() {
      const rows = document.querySelectorAll("#topicBody tr");
      const topicData = [];
      rows.forEach(row => {
        const topic = row.querySelector(".topicName").value.trim();
        const date = row.querySelector(".startDate").value;
        const color = row.querySelector(".topicColor").value || "#4a90e2";
        const reviewEnabled = row.querySelector(".enableReview").checked;
        if (topic && date) {
          topicData.push({ topic, date, color, reviewEnabled });
        }
      });
      // Store in memory instead of localStorage
      window.spacedTopicsData = topicData;
    }

    function loadSavedTopics() {
      document.getElementById("topicBody").innerHTML = "";
      const topics = window.spacedTopicsData || [];
      if (topics.length === 0) {
        // Add a sample topic if none exist
        addRow("Sample Topic", new Date().toISOString().split('T')[0], "#4a90e2", true);
        return;
      }
      topics.forEach(item => addRow(item.topic, item.date, item.color || "#4a90e2", item.reviewEnabled !== false));
    }

    function generateSchedule() {
      const rows = document.querySelectorAll("#topicBody tr");
      const events = [];
      const topicData = [];

      rows.forEach(row => {
        const topic = row.querySelector(".topicName").value.trim();
        const dateStr = row.querySelector(".startDate").value;
        const color = row.querySelector(".topicColor").value || "#4a90e2";
        const reviewEnabled = row.querySelector(".enableReview").checked;
        const startDate = new Date(dateStr);
        if (!topic || isNaN(startDate)) return;

        topicData.push({ topic, date: dateStr, color, reviewEnabled });

        const intervals = reviewEnabled ? [0, 1, 3, 7, 14, 30] : [0];

        intervals.forEach((offset, i) => {
          const reviewDate = new Date(startDate);
          reviewDate.setDate(reviewDate.getDate() + offset);
          const isoDate = reviewDate.toISOString().split("T")[0];
          events.push({
            title: `Review ${i + 1}: ${topic}`,
            start: isoDate,
            allDay: true,
            backgroundColor: color,
            borderColor: color
          });
        });
      });

      // Store in memory
      window.spacedTopicsData = topicData;

      const calendarEl = document.getElementById("calendar");
      calendarEl.innerHTML = "";
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        height: 600,
        events: events,
        eventDidMount: function (info) {
          const today = new Date().toISOString().split("T")[0];
          if (info.event.startStr === today) {
            info.el.style.background = "linear-gradient(135deg, #f5d5a8, #ffc107)";
            info.el.style.color = "#333";
            info.el.style.fontWeight = "600";
            info.el.style.transform = "scale(1.05)";
            info.el.style.zIndex = "10";
          }
        }
      });
      calendar.render();
      showToast("Calendar updated! âœ¨");
    }

    function exportTopics() {
      const data = JSON.stringify(window.spacedTopicsData || []);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "topics_backup.json";
      a.click();
      URL.revokeObjectURL(url);
      showToast("Topics exported! ðŸ“");
    }

    function importTopics(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);
          window.spacedTopicsData = data;
          loadSavedTopics();
          generateSchedule();
          showToast("Topics imported! ðŸ“¥");
        } catch {
          alert("Invalid JSON file. Please check your file format.");
        }
      };
      reader.readAsText(file);
      event.target.value = ''; // Reset file input
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 3000);
    }
  </script>
</body>

</html>